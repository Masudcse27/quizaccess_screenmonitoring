define("quizaccess_screenmonitoring/monitor",["jquery"],(function($){return{init:function(params){const interval=params.interval||5e3,quizid=params.quizid,cmid=params.cmid,userid=params.userid,attemptid=params.attemptid,uploadurl=(params.token,params.uploadurl);let startButtonClicked=!1;$(document).on("click",'form[action*="startattempt.php"] button[type=submit]',(function(e){e.preventDefault(),startButtonClicked||(!function(){const metadata={interval:interval,quizid:quizid,cmid:cmid,userid:userid,attemptid:attemptid,uploadurl:uploadurl};console.log("ðŸ“¤ Sending startCapture request to extension..."),window.postMessage({type:"FROM_MOODLE",action:"startCapture",interval:interval,meta:metadata},"*")}(),startButtonClicked=!0)})),window.addEventListener("message",(function(event){if(event.source!==window||!event.data||"FROM_EXTENSION"!==event.data.type)return;const msg=event.data;if("captureStarted"===msg.status){const form=$('form[action*="startattempt.php"]')[0];form&&form.submit()}else"captureFailed"===msg.status&&(alert("Screen sharing was cancelled or failed. Please try again."),startButtonClicked=!1)})),$(document).on("click","button[type=submit]",(function(){const text=this.textContent.trim().toLowerCase();(text.includes("submit all and finish")||text.includes("finish attempt")||text.includes("submit quiz"))&&(console.log("ðŸ“¤ Sending stopCapture request to extension..."),window.postMessage({type:"FROM_MOODLE",action:"stopCapture"},"*"))}))}}}));

//# sourceMappingURL=monitor.min.js.map