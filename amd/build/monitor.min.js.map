{"version":3,"file":"monitor.min.js","sources":["../src/monitor.js"],"sourcesContent":["define(['jquery'], function ($) {\n    return {\n        init: function (params) {\n            const interval = params.interval || 5000;\n            const quizid = params.quizid;\n            const cmid = params.cmid;\n            const userid = params.userid;\n            const attemptid = params.attemptid;\n            const token = params.token;\n            const uploadurl = params.uploadurl;\n\n            let startButtonClicked = false;\n\n            function sendStartCapture() {\n                const metadata = {\n                    interval: interval,\n                    quizid: quizid,\n                    cmid: cmid,\n                    userid: userid,\n                    attemptid: attemptid,\n                    uploadurl: uploadurl\n                };\n\n                console.log('ðŸ“¤ Sending startCapture request to extension...');\n                window.postMessage({\n                    type: 'FROM_MOODLE',\n                    action: 'startCapture',\n                    interval: interval,\n                    meta: metadata\n                }, '*');\n            }\n\n            function sendStopCapture() {\n                console.log('ðŸ“¤ Sending stopCapture request to extension...');\n                window.postMessage({\n                    type: 'FROM_MOODLE',\n                    action: 'stopCapture'\n                }, '*');\n            }\n\n            $(document).on('click', 'form[action*=\"startattempt.php\"] button[type=submit]', function (e) {\n                e.preventDefault();\n                if (!startButtonClicked) {\n                    sendStartCapture();\n                    startButtonClicked = true;\n                }\n            });\n\n            window.addEventListener('message', function (event) {\n                if (event.source !== window || !event.data || event.data.type !== 'FROM_EXTENSION') return;\n                const msg = event.data;\n\n                if (msg.status === 'captureStarted') {\n                    const form = $('form[action*=\"startattempt.php\"]')[0];\n                    if (form) {\n                        form.submit();\n                    }\n                } else if (msg.status === 'captureFailed') {\n                    alert('Screen sharing was cancelled or failed. Please try again.');\n                    startButtonClicked = false;\n                }\n            });\n\n            $(document).on('click', 'button[type=submit]', function () {\n                const text = this.textContent.trim().toLowerCase();\n                if (text.includes('submit all and finish') || text.includes('finish attempt') || text.includes('submit quiz')) {\n                    sendStopCapture();\n                }\n            });\n        }\n    };\n});\n"],"names":["define","$","init","params","interval","quizid","cmid","userid","attemptid","uploadurl","token","startButtonClicked","document","on","e","preventDefault","metadata","console","log","window","postMessage","type","action","meta","sendStartCapture","addEventListener","event","source","data","msg","status","form","submit","alert","text","this","textContent","trim","toLowerCase","includes"],"mappings":"AAAAA,6CAAO,CAAC,WAAW,SAAUC,SAClB,CACHC,KAAM,SAAUC,cACNC,SAAWD,OAAOC,UAAY,IAC9BC,OAASF,OAAOE,OAChBC,KAAOH,OAAOG,KACdC,OAASJ,OAAOI,OAChBC,UAAYL,OAAOK,UAEnBC,WADQN,OAAOO,MACHP,OAAOM,eAErBE,oBAAqB,EA6BzBV,EAAEW,UAAUC,GAAG,QAAS,wDAAwD,SAAUC,GACtFA,EAAEC,iBACGJ,uCA5BCK,SAAW,CACbZ,SAAUA,SACVC,OAAQA,OACRC,KAAMA,KACNC,OAAQA,OACRC,UAAWA,UACXC,UAAWA,WAGfQ,QAAQC,IAAI,mDACZC,OAAOC,YAAY,CACfC,KAAM,cACNC,OAAQ,eACRlB,SAAUA,SACVmB,KAAMP,UACP,KAcCQ,GACAb,oBAAqB,MAI7BQ,OAAOM,iBAAiB,WAAW,SAAUC,UACrCA,MAAMC,SAAWR,SAAWO,MAAME,MAA4B,mBAApBF,MAAME,KAAKP,KAA2B,aAC9EQ,IAAMH,MAAME,QAEC,mBAAfC,IAAIC,OAA6B,OAC3BC,KAAO9B,EAAE,oCAAoC,GAC/C8B,MACAA,KAAKC,aAEa,kBAAfH,IAAIC,SACXG,MAAM,6DACNtB,oBAAqB,MAI7BV,EAAEW,UAAUC,GAAG,QAAS,uBAAuB,iBACrCqB,KAAOC,KAAKC,YAAYC,OAAOC,eACjCJ,KAAKK,SAAS,0BAA4BL,KAAKK,SAAS,mBAAqBL,KAAKK,SAAS,kBAhC/FtB,QAAQC,IAAI,kDACZC,OAAOC,YAAY,CACfC,KAAM,cACNC,OAAQ,eACT"}